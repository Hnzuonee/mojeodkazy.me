<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ověření | Vaše Jméno/Brand</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&family=Poppins:wght@600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet" />
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <style>
      :root { 
          --violet: #be4dff; --violet-d: #9c3bdb; --bg: #16161d; --card: #242432; 
          --text: #f5f5f5; --muted: #aaa; --success-color: #22c55e;
          --accent-color: #db2777; /* Přidáno pro konzistenci */
      }
      * { box-sizing: border-box; }
      body {
        margin: 0; font-family: 'Lato', sans-serif; background: var(--bg); color: var(--text);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        min-height: 100vh; text-align: center; padding: 2rem;
      }
      .card {
        width: 100%; max-width: 420px; background: var(--card);
        padding: 2.5rem; border-radius: 18px; box-shadow: 0 8px 28px rgba(0, 0, 0, .35);
      }
      img.avatar {
        width: 96px; height: 96px; border-radius: 50%; object-fit: cover; 
        border: 3px solid var(--accent-color); margin-bottom: 1.5rem;
        /* ZDE VLOŽTE URL K VAŠEMU AVATARU */
        content: url("images/IMG_8334.jpg");
      }
      h1 { font-family: 'Poppins', sans-serif; margin: .4rem 0 1rem; font-size: 24px; }
      p.bio { margin-bottom: 0.8rem; color: var(--secondary-text-color, #cfcfcf); font-size: 16px; }
      p.hint { margin-bottom: 1.5rem; color: var(--muted); font-size: 14px; font-style: italic; }
      .btn {
        display: block; width: 100%; margin-top: 1.5rem; padding: 15px;
        background: linear-gradient(135deg, var(--accent-color), var(--accent-hover-color, #c21c67)); 
        color: #fff; font-weight: 600;
        border: none; border-radius: 12px; font-size: 16px;
        font-family: 'Poppins', sans-serif;
        text-decoration: none; cursor: pointer; transition: background .2s, transform .2s;
      }
      .btn:hover { 
          background: linear-gradient(135deg, var(--accent-hover-color, #c21c67), var(--accent-color)); 
          transform: translateY(-2px); 
      }
      .hidden { display: none !important; } /* Důležité pro skrytí formuláře */
      .loader {
        width: 40px; height: 40px; border: 5px solid #444;
        border-top: 5px solid var(--accent-color); border-radius: 50%; 
        animation: spin 0.8s linear infinite; margin: 1.5rem auto;
      }
      @keyframes spin { 0% { transform: rotate(0); } 100% { transform: rotate(360deg); } }
      #cf-turnstile-widget { margin: 1.5rem auto; } /* Centrování widgetu */
    </style>
</head>
<body>
  <div class="card">
    <img src="images/profilova-fotka.webp" alt="Profil" class="avatar" /> <h1>Ověření Přístupu</h1>
    <p class="bio">Pro pokračování je potřeba provést rychlé bezpečnostní ověření.</p>
    <p id="verificationStatus" class="hint">Probíhá ověřování, že jste člověk... ⏳</p>

    <div id="loader" class="loader"></div>

    <form id="secureForm" method="POST" action="/.netlify/functions/verify-captcha" class="hidden">
        <div id="cf-turnstile-widget" class="cf-turnstile"
             data-sitekey="VASE_CLOUDFLARE_TURNSTILE_SITE_KEY" 
             data-theme="dark"
             data-size="normal" 
             data-callback="onTurnstileSuccess">
        </div>
        <input type="hidden" name="cf-turnstile-response" id="cfTurnstileResponse"/>
        <button type="submit" class="btn" id="submitButton">Pokračovat k obsahu</button>
    </form>
  </div>

  <script>
    // document.querySelector('.avatar').src = "images/profilova-fotka.webp"; // Nahraďte cestou k vašemu avataru

    // Globální callback funkce pro Turnstile (musí být v globálním scope)
    window.onTurnstileSuccess = function(token) {
        // console.log("Turnstile ověření úspěšné! Token:", token);
        
        const loader = document.getElementById("loader");
        const verificationStatus = document.getElementById("verificationStatus");
        const secureForm = document.getElementById("secureForm");
        const tokenInput = document.getElementById('cfTurnstileResponse');
        const turnstileWidget = document.getElementById('cf-turnstile-widget');

        if (loader) loader.style.display = 'none';
        
        if (verificationStatus) {
            verificationStatus.textContent = "Ověření proběhlo úspěšně. Můžete pokračovat.";
            verificationStatus.style.color = "var(--success-color)";
        }
        
        if (tokenInput) tokenInput.value = token;
        
        if (secureForm) secureForm.classList.remove("hidden");

        // Volitelně skryjeme samotný Turnstile widget po úspěchu, pokud už není potřeba
        // if (turnstileWidget) turnstileWidget.style.display = 'none'; 
    };

    // Zajistíme, že se Turnstile widget renderuje, i když je API načteno s 'defer'
    // Tento kód se spustí, až bude Turnstile API k dispozici
    function renderTurnstile() {
        if (typeof turnstile !== 'undefined') {
            turnstile.render('#cf-turnstile-widget', {
                // DŮLEŽITÉ: Nahraďte 'VASE_CLOUDFLARE_TURNSTILE_SITE_KEY' vaším skutečným Sitekey
                sitekey: '0x4AAAAAABexDPXLOkSffFaV',
                callback: 'onTurnstileSuccess', // Název globální callback funkce
                theme: 'dark',
                size: 'normal'
            });
            const loader = document.getElementById("loader");
            const verificationStatus = document.getElementById("verificationStatus");
            if(loader) loader.style.display = 'block'; // Ukázat loader, dokud se widget nenačte/nevyřeší
            if(verificationStatus) verificationStatus.textContent = "Probíhá ověřování, že jste člověk... ⏳";

        } else {
            // Pokud Turnstile API není dostupné, zkusíme to za chvíli znovu
            // console.log("Turnstile API not ready, retrying...");
            setTimeout(renderTurnstile, 200);
        }
    }

    // Pokud je Turnstile API načteno s `async defer`, nemusí být `window.onload` nejlepší.
    // `window.onloadTurnstileCallback` je někdy používáno, nebo explicitní render.
    // Pro jistotu voláme render po načtení DOMu, s možností opakování, pokud API ještě není.
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        renderTurnstile();
    } else {
        document.addEventListener('DOMContentLoaded', renderTurnstile);
    }
  </script>
</body>
</html>
